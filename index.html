<!DOCTYPE html>
<html lang="en" data-bs-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parallel Editing</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/quill-cursors/2.2.1/quill-cursors.min.css">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">

  <!-- Custom Styles -->
  <link rel="stylesheet" href="styles.css">

  <style>
    #editor-container {
      height: 70vh;
      font-family: 'Georgia', serif;
      font-size: 1.1rem;
    }

    .ai-active-border {
      border: 2px solid #0d6efd !important;
      transition: border 0.3s;
    }

    #suggestion-toolbar {
      z-index: 1000;
      display: none;
      position: absolute;
    }

    /* Make Cursors Pop */
    .ql-cursor-caret-container {
      z-index: 100 !important;
    }

    .ql-cursor-flag {
      white-space: nowrap;
      font-size: 12px;
      font-weight: bold;
      padding: 2px 6px;
      /* Force Visibility */
      border-bottom-left-radius: 0 !important;
      opacity: 1 !important;
      visibility: visible !important;
      display: block !important;
      transition: none !important;
    }

    /* Ensure the flag container is also visible */
    .ql-cursor-flag-container {
      opacity: 1 !important;
      visibility: visible !important;
      display: block !important;
    }

    /* Demo Cards */
    .demo-card {
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      background: linear-gradient(135deg, var(--bs-body-bg) 0%, var(--bs-secondary-bg) 100%);
    }

    .demo-card:hover {
      transform: translateY(-4px);
      border-color: var(--bs-primary);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .demo-card.active {
      border-color: var(--bs-success);
      background: linear-gradient(135deg, var(--bs-success-bg-subtle) 0%, var(--bs-primary-bg-subtle) 100%);
    }

    /* Agent Activity Panel */
    .agent-item {
      border-left: 4px solid;
      transition: all 0.3s ease;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .agent-item.working {
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.7;
      }
    }

    .agent-status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
      animation: blink 1.5s ease-in-out infinite;
    }

    @keyframes blink {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.3;
      }
    }

    /* Sample Prompts */
    .sample-prompt {
      cursor: pointer;
      transition: all 0.2s ease;
      border-left: 3px solid var(--bs-primary);
    }

    .sample-prompt:hover {
      background-color: var(--bs-primary-bg-subtle);
      border-left-width: 5px;
      transform: translateX(5px);
    }

    /* Highlight sections being edited */
    .agent-highlight {
      background-color: rgba(255, 235, 59, 0.2);
      border-left: 4px solid;
      padding-left: 8px;
      transition: all 0.3s ease;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom border-secondary shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center gap-2" href=".">
        <span class="fw-bold">Parallel Edit</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav me-auto mb-2 mb-lg-0 align-items-center gap-3">
          <div
            class="d-flex align-items-center rounded bg-secondary bg-opacity-25 px-3 py-1 text-light border border-secondary">
            <span id="connection-status-dot" class="d-inline-block rounded-circle bg-warning me-2"
              style="width: 8px; height: 8px;"></span>
            <span id="connection-status-text" class="small">Connecting...</span>
          </div>
        </div>

        <div class="ms-auto d-flex align-items-center gap-3">
          <span class="badge bg-dark border border-secondary text-light"><i class="bi bi-people-fill me-1"></i> <span
              id="user-count">1</span></span>
          <button id="btn-new-session" class="btn btn-sm btn-outline-success"><i class="bi bi-plus-lg"></i> New
            Session</button>
          <button id="btn-share" class="btn btn-sm btn-outline-light"><i class="bi bi-share-fill"></i> Share</button>
          <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal" data-bs-target="#llmConfigModal"><i
              class="bi bi-gear-fill"></i> Config</button>

          <div class="nav-item dropdown" role="group">
            <button class="dark-theme-toggle btn btn-outline-secondary btn-sm dropdown-toggle text-light" type="button"
              data-bs-toggle="dropdown">
              <i class="bi bi-circle-half"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><button class="dropdown-item active" data-bs-theme-value="light"><i class="me-2 bi bi-sun-fill"></i>
                  Light</button></li>
              <li><button class="dropdown-item" data-bs-theme-value="dark"><i class="me-2 bi bi-moon-stars-fill"></i>
                  Dark</button></li>
              <li><button class="dropdown-item" data-bs-theme-value="auto"><i class="me-2 bi bi-circle-half"></i>
                  Auto</button></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div id="main-app" class="container-fluid mt-4">
    <!-- Hero / Intro Section -->
    <div id="hero-section" class="container text-center mt-2">
      <h1 class="display-3 my-2 text-center">Parallel Edit</h1>

      <h2 class="display-6 text-center">
        Collaborative Intelligence for <em>Complex</em> Documents
      </h2>

      <div class="mx-auto my-2 narrative">
        <p class="mb-2 mt-2">
          Experience the future of collaborative writing. Parallel Edit allows you to work alongside a hive-mind of
          specialized AI agents.
        </p>
        <ul class="mb-0 text-start d-inline-block">
          <li>Start with real-time multi-agent collaboration that never sleeps.</li>
          <li><em>Configure your AI team</em> to verify facts, fix style, and draft content.</li>
          <li>Work without conflicts using our specialized parallel editing engine.</li>
          <li>
            <a href="#" data-bs-toggle="modal" data-bs-target="#infoModal" class="text-decoration-none fw-bold">
              <i class="bi bi-info-circle-fill me-1"></i> How it works (Architecture)
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Demo Scenarios Header -->
    <div class="row mb-3">
      <div class="col-12 text-center">
        <h3 class="h5 mb-3">Start with a Scenario</h3>
      </div>
      <div class="col-12">
        <!-- Cards Container -->
        <div class="row g-3 justify-content-center" id="demo-cards-container">
          <!-- Demo cards will be dynamically inserted here by script.js -->
        </div>
      </div>
    </div>

    <hr class="my-5 opacity-25">

    <!-- Sample Prompts Section (Moved here) -->
    <div class="row mb-4 justify-content-center">
      <div class="col-lg-8">
        <div id="sample-prompts-container" class="d-flex flex-wrap gap-2 justify-content-center">
          <!-- Sample prompts will be dynamically inserted here -->
        </div>
      </div>
    </div>

    <!-- Editor Section -->
    <div class="row g-4">
      <div class="col-lg-7">
        <div class="card shadow-sm h-100">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span class="fw-bold" id="document-title">Agreement.docx</span>
            <div class="d-flex gap-2">
              <div class="vr"></div>
              <label for="file-upload" class="btn btn-sm btn-outline-primary mb-0" title="Upload PDF or Text file">
                <i class="bi bi-upload"></i> Upload
              </label>
              <input type="file" id="file-upload" accept=".pdf,.txt,.md" style="display: none;">
            </div>
          </div>
          <div id="editor-container"></div>
        </div>
      </div>

      <div class="col-lg-5">
        <div class="row g-3 h-100">
          <!-- AI Co-Pilot Panel -->
          <div class="col-12">
            <div class="card shadow-sm border-0 bg-body-tertiary">
              <div class="card-header bg-primary text-white">
                <i class="bi bi-robot me-2"></i>AI Co-Pilot
              </div>
              <div class="card-body">
                <textarea id="custom-prompt" class="form-control mb-2" rows="2"
                  placeholder="e.g. Add a liability cap of $50k"></textarea>
                <div class="d-grid gap-2">
                  <button id="btn-trigger" class="btn btn-primary btn-sm">
                    <i class="bi bi-play-fill me-1"></i>Draft / Edit
                  </button>
                </div>
                <div id="ai-status" class="badge bg-secondary d-none mt-2">Thinking...</div>
              </div>
            </div>
          </div>

          <!-- Multi-Agent Activity Panel -->
          <div class="col-12">
            <!-- Parent Agent Status -->
            <div class="card shadow-sm border-0 bg-body-tertiary mb-3" id="parent-agent-card" style="display: none;">
              <div class="card-header bg-warning text-white d-flex justify-content-between align-items-center">
                <span><i class="bi bi-stars me-2"></i>Parent Agent (Supervisor)</span>
                <span class="badge bg-light text-dark" id="parent-status">Planning</span>
              </div>
              <div class="card-body p-2">
                <div id="parent-agent-info" class="small text-white">
                  <div class="mb-1"><strong>Role:</strong> Coordinating team and ensuring quality</div>
                  <div id="parent-analysis" class="text-muted"></div>
                </div>
              </div>
            </div>

            <!-- Child Agents Activity -->
            <div class="card shadow-sm border-0 bg-body-tertiary">
              <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <span><i class="bi bi-diagram-3 me-2"></i>Agent Activity</span>
                <div class="d-flex gap-2 align-items-center">
                  <span class="badge bg-light text-dark" id="active-agents-count">0 Active</span>
                  <button id="btn-clear-agents" class="btn btn-sm btn-outline-light py-0"
                    style="font-size: 0.75rem;">Clear</button>
                </div>
              </div>
              <div class="card-body p-0">
                <div id="agent-activity-container" class="p-3" style="max-height: 300px; overflow-y: auto;">
                  <p class="text-muted text-center small mb-0">No agents currently working</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Logs Panel -->
          <div class="col-12">
            <div class="card shadow-sm border-0 bg-body-tertiary">
              <div class="card-header bg-secondary text-white">
                <i class="bi bi-terminal me-2"></i>Activity Log
              </div>
              <div class="card-body p-2">
                <div id="logs" class="small font-monospace text-muted" style="height: 150px; overflow-y: auto;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- WELCOME MODAL -->
  <div class="modal fade" id="welcomeModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Welcome to Parallel Editing</h5>
        </div>
        <div class="modal-body">
          <p class="mb-2">Enter your name to join the session:</p>
          <input type="text" id="user-name-input" class="form-control" placeholder="Your Name" autofocus>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="btn-join">Join Session</button>
        </div>
      </div>
    </div>
  </div>

  <!-- INFO MODAL -->
  <div class="modal fade" id="infoModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title fw-bold"><i class="bi bi-info-circle-fill me-2 text-primary"></i>How Parallel Edit
            Works</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row g-4">
            <div class="col-md-6">
              <h6 class="fw-bold text-primary mb-3">1. Background Technology</h6>
              <div class="d-flex mb-3">
                <i class="bi bi-braces fs-4 me-3 text-secondary"></i>
                <div>
                  <strong>Y.js & CRDTs:</strong> The core is built on <a href="https://github.com/yjs/yjs"
                    target="_blank">Y.js</a>, a high-performance CRDT library. This ensures that every keystroke is
                  eventually consistent across all users without merge conflicts.
                </div>
              </div>
              <div class="d-flex mb-3">
                <i class="bi bi-broadcast fs-4 me-3 text-secondary"></i>
                <div>
                  <strong>WebRTC:</strong> We use <a href="https://github.com/yjs/y-webrtc" target="_blank">y-webrtc</a>
                  for peer-to-peer data syncing. No central database stores your document state; it lives in the mesh of
                  connected browsers.
                </div>
              </div>
              <div class="d-flex">
                <i class="bi bi-file-earmark-richtext fs-4 me-3 text-secondary"></i>
                <div>
                  <strong>Quill Editor:</strong> The editor is <a href="https://quilljs.com/" target="_blank">Quill</a>,
                  bound to Y.js types. This allows rich text handling that multiple users (and bots) can edit
                  simultaneously.
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <h6 class="fw-bold text-success mb-3">2. AI Architecture</h6>
              <div class="d-flex mb-3">
                <i class="bi bi-robot fs-4 me-3 text-secondary"></i>
                <div>
                  <strong>Agentic Workflow:</strong> When you request a change, a "Supervisor" agent plans the task and
                  delegates sub-tasks to specialized agents (e.g., "Legal Verifier", "Drafter").
                </div>
              </div>
              <div class="d-flex">
                <i class="bi bi-pen fs-4 me-3 text-secondary"></i>
                <div>
                  <strong>Conflict-Free AI:</strong> Agents don't just "overwrite" text. They perform precise atomic
                  operations on the shared Y.js document model. This treats the AI as just another user in the session,
                  preventing it from accidentally deleting your work while you type.
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="alert alert-secondary mb-0 small">
                <strong>Tech Stack:</strong> Vanilla JS (ES Modules), Bootstrap 5, Y.js, Quill, WebRTC, OpenAI/LLM API.
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="llmConfigModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Settings</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <label>API Key</label><input type="password" id="llm-api-key" class="form-control mb-2">
          <label>Base URL</label><input type="text" id="llm-url" class="form-control mb-2"
            placeholder="https://api.openai.com/v1">
          <label>Model</label>
          <select id="llm-model" class="form-select">
            <!-- Options populated by JS -->
          </select>
        </div>
        <div class="modal-footer"><button type="button" class="btn btn-primary" id="save-llm-config">Save</button></div>
      </div>
    </div>
  </div>

  <script type="importmap">
{
  "imports": {
    "yjs": "https://esm.sh/yjs@13",
    "y-webrtc": "https://esm.sh/y-webrtc@10?external=yjs",
    "y-indexeddb": "https://esm.sh/y-indexeddb?external=yjs",
    "y-quill": "https://esm.sh/y-quill?external=yjs,quill",
    "quill": "https://esm.sh/quill@1.3.6",
    "quill-cursors": "https://esm.sh/quill-cursors@2.2.1?external=quill",
    "fast-diff": "https://esm.sh/fast-diff"
  }
}
</script>
  <script src="https://cdn.jsdelivr.net/npm/@gramex/ui@0.3.1/dist/dark-theme.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="script.js"></script>
</body>

</html>